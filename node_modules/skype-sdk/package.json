{
  "name": "skype-sdk",
  "version": "1.0.6",
  "description": "SDK for Skype bots.",
  "main": "index.js",
  "scripts": {
    "doc": "node node_modules/jsdoc/jsdoc.js -c jsdoc.conf -t node_modules/ink-docstrap/template -d doc -R README.md"
  },
  "author": {
    "name": "David Marek",
    "email": "damarek@microsoft.com"
  },
  "license": "UNLICENSED",
  "private": true,
  "engines": {
    "node": ">=5.6.0"
  },
  "dependencies": {
    "async": "^1.5.2",
    "busboy": "^0.2.12",
    "debug": "^2.2.0",
    "node-forge": "^0.6.38",
    "node-uuid": "^1.4.7",
    "request": "^2.67.0",
    "restify": "^4.0.4"
  },
  "devDependencies": {
    "chai": "^3.4.1",
    "del": "^2.2.0",
    "gulp": "^3.9.1",
    "gulp-eslint": "^2.0.0",
    "gulp-gzip": "^1.2.0",
    "gulp-istanbul": "^0.10.3",
    "gulp-mocha": "^2.2.0",
    "gulp-tar": "^1.8.0",
    "ink-docstrap": "^1.1.4",
    "jsdoc": "^3.4.0",
    "mocha": "^2.3.4",
    "nock": "^5.2.1",
    "sinon": "^1.17.2",
    "typings": "^0.6.2"
  },
  "readme": "# Getting started\r\n\r\nLet's say you want to build an echo messaging bot.\r\n \r\n## Requirements\r\n\r\nIf you don't have them, go to the official Node.js website and install the latest versions of:\r\n\r\n* Node.js and package ecosystem npm\r\n\r\nBoth are available from the official page. \r\n\r\n## Configuration\r\n\r\nBefore you get started, make sure you register your bot. Also have ready your:\r\n* Bot’s ID\r\n* Application ID If you've forgotten it, you can find your Application's ID in Details in My Bots.\r\n* Your Application Secret If you've misplaced your Application Secret, you'll have to generate a new one at Microsoft Applications. \r\n\r\nCreate a directory for your bot and navigate to it:\r\n```\r\n> mkdir echo_bot\r\n> cd echo_bot\r\n```\r\n\r\nInitialize an npm project:\r\n```\r\n> npm init\r\n```\r\n\r\nInstall the dependencies:\r\n```\r\n> npm install --save restify\r\n```\r\nDownload the Skype-SDK package skype-sdk.tar.gz and install it using npm:\r\n```\r\n> npm install --save ./skype-sdk.tar.gz\r\n```\r\n\r\nUpdate your package.json file to include the \"engines\" attribute:\r\n```javascript\r\n{\r\n…\r\n\"engines\": {\r\n\"node\": \">=5.6.0\"\r\n},\r\n…\r\n}\r\n```\r\n \r\n## Create server.js\r\n\r\nYou need to create a server.js file to:\r\n* Initialize the bot service\r\n* Initialize your bot\r\n* Run everything within a restify framework\r\n\r\nLet's get started.\r\n1. Import all the needed libraries:\r\n * The restify framework\r\n * The Skype SDK\r\n2. Create new instances of:\r\n * The {@link BotService} class configured for messaging. Your APP_ID and APP_SECRET environment variables have OAuth credentials.\r\n * The restify server\r\n3. Add an event handler for [new contacts]{@link BotService#event:contactAdded} and reply with welcome message (set “escape” flag to true in your [reply]{@link Bot#reply} call, to accept invalid characters in user’s display names).\r\n4. Add a [personal message event handler]{@link BotService#event:personalMessage} to echo and reply to incoming messages (set “escape” flag to true in your [reply]{@link Bot#reply} call, to accept invalid characters in user’s message).\r\n5. Configure one route for incoming events.\r\n6. Use the Skype SDK middleware functions to pass requests to BotService.\r\n * POST to /v1/chat for incoming events\r\n\r\nThe code should look like this:\r\n \r\n```javascript\r\nconst fs = require('fs');\r\nconst restify = require('restify');\r\nconst skype = require('skype-sdk');\r\n\r\nconst botService = new skype.BotService({\r\n    messaging: {\r\n        botId: '28:<bot’s id>',\r\n        serverUrl : \"https://apis.skype.com \",\r\n        requestTimeout : 15000,\r\n        appId: process.env.APP_ID,\r\n        appSecret: process.env.APP_SECRET\r\n    }\r\n});\r\n\r\nbotService.on('contactAdded', (bot, data) => {\r\n    bot.reply(`Hello ${data.fromDisplayName}!`, true);\r\n});\r\n\r\nbotService.on('personalMessage', (bot, data) => {\r\n    bot.reply(`Hey ${data.from}. Thank you for your message: \"${data.content}\".`, true);\r\n});\r\n\r\nconst server = restify.createServer();\r\nserver.post('/v1/chat', skype.messagingHandler(botService));\r\nconst port = process.env.PORT || 8080;\r\nserver.listen(port);\r\nconsole.log('Listening for incoming requests on port ' + port); \r\n```\r\n\r\n## Start the bot\r\nYour bot is ready. Start it and test it locally:\r\n```\r\n> node server.js\r\n```\r\nMake sure you created environment variables:\r\n* APP_ID With your application ID.\r\n* APP_SECRET With your application secret for OAuth.\r\nIf you don't, your bot won't authenticate and won't be able to call into Skype services.\r\n\r\nYou can also create an environment variable PORT to change the default port 8080. \r\n\r\nFinally, if you want to see the debugging messages we added to the code, enter:\r\n```\r\n> set DEBUG=skype-sdk*\r\n``` \r\n\r\n## Deployment to Azure \r\n\r\nFollow the [Create a Node.js web app in Azure App Service](https://azure.microsoft.com/en-us/documentation/articles/web-sites-nodejs-develop-deploy-mac/) article to create your Azure service and deploy it.\r\nGo to Azure portal, “App Services”, select your service, “Settings”, “Application settings”, go to “App settings” section and add your environment variables APP_ID and APP_SECRET there. You can also set up the DEBUG variable.\r\n\r\nOnce your service is deployed to Azure you can start testing the bot with Skype.\r\n\r\nIf your service is running on Azure, you might want to ensure that you are getting requests really from Bot Platform and not from someone just pretending to be the messaging service. You can use middleware that was created for skype-sdk. Modify your server.js and add following lines after the creation of your server.\r\n```javascript\r\nconst server = restify.createServer();\r\nserver.use(skype.ensureHttps(true));\r\nserver.use(skype.verifySkypeCert());\r\n```\r\n\r\nThe first middleware, `skype.ensureHttps(true)` will redirect all requests to https endpoint. If you want to reject them, use `skype.ensureHttps(true, 404)` to reply with 404 Not Found.\r\n\r\nThe second middleware, `server.use(skype.verifySkypeCert())` will allow requests only from Bot Platform. To use it, you need to configure your Azure service to require client certificate. Follow https://azure.microsoft.com/en-gb/documentation/articles/app-service-web-configure-tls-mutual-auth/ to turn on this feature. \r\n\r\n## Escaping special characters in messages\r\n\r\nIf your bot fails to send messages, you may have to escape special characters in the content. The rules for replacing characters are:\r\n* Replace & with `&amp;`\r\n* Replace < with `&lt;`\r\n* Replace > with `&gt;`\r\n\r\nThis is already done for you in the SDK, there is an `escape` argument in `send()` and `reply()` functions. Set it to true to escape your message.\r\n\r\n## Testing with ngrok \r\n\r\nThere are tools that can create a public url to your local webserver on your machine, e.g. [ngrok](https://ngrok.com/). We’ll show how you can test your bot running locally over skype.\r\n\r\nYou’ll need to download ngrok and modify your bot’s registration.\r\n\r\nFirst step is to start ngrok on your machine and map it to a local http port:\r\n```\r\n> ngrok http 8000\r\n```\r\nThis will create a new tunnel from a public url to [http://localhost:8000](http://localhost:8000) on your machine. After you start the command, you can see the status of the tunnel:\r\n```\r\nngrok by @inconshreveable                                           (Ctrl+C to quit)\r\nTunnel Status       online\r\nUpdate              update available (version 2.0.24, Ctrl-U to update)\r\nVersion             2.0.19/2.0.25\r\nWeb Interface       http://127.0.0.1:4040\r\nForwarding          http://78191649.ngrok.io -> localhost:8000\r\nForwarding          https://78191649.ngrok.io -> localhost:8000\r\n\r\nConnections     ttl     opn     rt1     rt5     p50     p90\r\n                0       0       0.00    0.00    0.00    0.00\r\n```\r\n\r\nNotice the “Forwarding” lines, in this case you can see that ngrok created two endpoints for us [http://78191649.ngrok.io](http://78191649.ngrok.io) and [https://78191649.ngrok.io](http://78191649.ngrok.io) for http and https traffic.\r\n\r\nYou will now need to configure your Bot to use these endpoints. Don’t forget to append your route when updating the messaging url, the new url should look like this: [https://78191649.ngrok.io/v1/chat](https://78191649.ngrok.io/v1/chat)\r\n\r\nNow you can start your server locally\r\n```\r\n> node server.js\r\nListening for incoming requests on port 8000\r\n```\r\n\r\nAnd send messages to your bot over skype, they will be sent by Bot Platform to [https://78191649.ngrok.io/v1/chat](https://78191649.ngrok.io/v1/chat) and ngrok will forward them to your machine. You just need to keep ngrok running.\r\nYou will see each request logged in the ngrok’s tunnel status table:\r\n```\r\nHTTP Requests\r\n-------------\r\n\r\nPOST /v1/chat                  100 Continue\r\nPOST /v1/chat                  201 Created\r\n```\r\nIf you are done with testing, you can stop ngrok (Ctrl+C), your agent will stop working as there is nothing to forward the requests to your local server.\r\n\r\n**Note**: Free version of ngrok will create a new unique url for you everytime you start it. That means you always need to go back and update the messaging url for your bot.\r\n\r\n**Note**: When running locally with ngrok, you need to comment out the call to skype.ensureHttps(true), because your service is not running as https server. ",
  "readmeFilename": "README.md",
  "_id": "skype-sdk@1.0.6",
  "_shasum": "89a021281fa85092c0f9896aaf27e0b106000739",
  "_resolved": "file:skype-sdk.tar.gz",
  "_from": "skype-sdk.tar.gz"
}
